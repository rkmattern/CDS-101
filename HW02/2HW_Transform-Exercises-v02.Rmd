---
title: "2HW_Mattern - Transformations"
author: "Rebecca Mattern"
date: "October 3, 2017"
output:
  word_document:
    reference_docx: CDS_HW_Template.docm
  pdf_document: default
  html_document: default
mainfont: Arial
geometry: margin=.5in
fontsize: 12pt
---
<style>
 .author { text-align        : center; margin : 0px; }       
 .title  { text-align        : center; margin : 0px; }       
 .date   { text-align        : center; margin : 0px; }       
  H4     { margin-top        : 20px;
           margin-left       : 10px;
           margin-bottom     :  5px;
           }
 .Pagebreak {
          font-size         :  1px;
          margin-top        : -12px;
          page-break-after  :  always;
          }
</style>

# 5 Data transformation {#transform}

<!-- -------------------------------------------------------------------------------- -->

```{r setup, message = FALSE}
library(nycflights13)
library(tidyverse)
```

## 5.2 Filter rows with `filter()`

### 5.2.4 Exercises

1.  Find all flights that
    1.  Had an arrival delay of two or more hours
        ```{r}
            n_distinct( flights )
            n_distinct( filter(flights, arr_delay > 120) )
        ```
    2.  Flew to Houston (`IAH` or `HOU`)
        ```{r}
          # colnames(flights )
            n_distinct( filter(flights, dest == "IAH" | dest == "HOU") )
        ```
    3.  Were operated by United, American, or Delta
        ```{r}

        ```
    4.  Departed in summer (July, August, and September)
        ```{r}

        ```
    5.  Arrived more than two hours late, but didn't leave late
        ```{r}

        ```
    6.  Were delayed by at least an hour, but made up over 30 minutes in flight
        ```{r}
 
        ```
    7.  Departed between midnight and 6am (inclusive)
        ```{r}
        #  select( flights, dep_time )        
        #  filter( flights, dep_time > 0 & dep_time <= 600 )
           n_distinct( filter( flights, dep_time > 0 & dep_time <= 600 ) )
        ```
2.  Another useful dplyr filtering helper is `between()`. What does it do?
    Can you use it to simplify the code needed to answer the previous challenges?
    ```{r}
       n_distinct( filter(flights, between( dep_time, 0, 600) ) )
    ``` 

3.  How many flights have a missing `dep_time`? What other variables are 
    missing? What might these rows represent?
    ```{r}

    ```    

4.  Why is `NA ^ 0` not missing? Why is `NA | TRUE` not missing?
    Why is `FALSE & NA` not missing? Can you figure out the general
    rule?  (`NA * 0` is a tricky counterexample!)
    ```{r}

    ```    

<!-- -------------------------------------------------------------------------------- -->
<div class="Pagebreak">&#160; &#160;&#160;</div> \pagebreak

## 5.3 Arrange rows with `arrange()`

### 5.3.1 Exercises

1.  How could you use `arrange()` to sort all missing values to the start?
    (Hint: use `is.na()`).
    
2.  Sort `flights` to find the most delayed flights. Find the flights that
    left earliest.

3.  Sort `flights` to find the fastest flights.

4.  Which flights travelled the longest? Which travelled the shortest?

<!-- -------------------------------------------------------------------------------- -->
<div class="Pagebreak">&#160; &#160;&#160;</div> \pagebreak

## 5.4 Select columns with `select()` {#select}

### 5.4.1 Exercises

1.  Brainstorm as many ways as possible to select `dep_time`, `dep_delay`,
    `arr_time`, and `arr_delay` from `flights`.
    
2.  What happens if you include the name of a variable multiple times in
    a `select()` call?
  
3.  What does the `one_of()` function do? Why might it be helpful in conjunction
    with this vector?
    
    ```{r}
    vars <- c("year", "month", "day", "dep_delay", "arr_delay")
    ```
    
4.  Does the result of running the following code surprise you?  How do the
    select helpers deal with case by default? How can you change that default?

    ```{r, eval = FALSE}
    select(flights, contains("TIME"))
    ```
<!-- -------------------------------------------------------------------------------- -->
<div class="Pagebreak">&#160; &#160;&#160;</div> \pagebreak

## 5.5 Add new variables with `mutate()`

### 5.5.2 Exercises

```{r, eval = FALSE, echo = FALSE}
    flights <- flights %>% mutate(
        dep_time = hour * 60 + minute,
        arr_time = (arr_time %/% 100) * 60 + (arr_time %% 100),
        airtime2 = arr_time - dep_time,
        dep_sched = dep_time + dep_delay
        )

    ggplot(flights, aes(dep_sched)) + geom_histogram(binwidth = 60)
    ggplot(flights, aes(dep_sched %% 60)) + geom_histogram(binwidth = 1)
    ggplot(flights, aes(air_time - airtime2)) + geom_histogram()
```

1.  Currently `dep_time` and `sched_dep_time` are convenient to look at, but
    hard to compute with because they're not really continuous numbers. 
    Convert them to a more convenient representation of number of minutes since midnight.
    
2.  Compare `air_time` with `arr_time - dep_time`. What do you expect to see?
    What do you see? What do you need to do to fix it?
    
3.  Compare `dep_time`, `sched_dep_time`, and `dep_delay`. How would you
    expect those three numbers to be related?

4.  Find the 10 most delayed flights using a ranking function. How do you want 
    to handle ties? Carefully read the documentation for `min_rank()`.

5.  What does `1:3 + 1:10` return? Why?

6.  What trigonometric functions does R provide?

<!-- -------------------------------------------------------------------------------- -->
<div class="Pagebreak">&#160; &#160;&#160;</div> \pagebreak

## 5.6 Grouped summaries with `summarise()`

### 5.6.7 Exercises

1.  Brainstorm at least 5 different ways to assess the typical delay 
    characteristics of a group of flights. Consider the following scenarios:
    
    * A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of 
      the time.
      
    * A flight is always 10 minutes late.

    * A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of 
      the time.
      
    * 99% of the time a flight is on time. 1% of the time it's 2 hours late.
    
    Which is more important: arrival delay or departure delay?

2.  Come up with another approach that will give you the same output as 
    `not_cancelled %>% count(dest)` and 
    `not_cancelled %>% count(tailnum, wt = distance)` (without using 
    `count()`).

3.  Our definition of cancelled flights (`is.na(dep_delay) | is.na(arr_delay)`
    ) is slightly suboptimal. Why? Which is the most important column?

4.  Look at the number of cancelled flights per day. Is there a pattern?
    Is the proportion of cancelled flights related to the average delay?

5.  Which carrier has the worst delays? Challenge: can you disentangle the
    effects of bad airports vs. bad carriers? Why/why not? (Hint: think about
    `flights %>% group_by(carrier, dest) %>% summarise(n())`)

6.  What does the `sort` argument to `count()` do. When might you use it?

<!-- -------------------------------------------------------------------------------- -->
<div class="Pagebreak">&#160; &#160;&#160;</div> \pagebreak
